var background=(function(){"use strict";function y(e){return e==null||typeof e=="function"?{main:e}:e}const s=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome,c={correctionEnabled:!0,highlightColor:"#FF6B35",browserAI:{enabled:!1,modelId:"smollm",customTerms:[]}},l="lexilens_settings";async function u(){try{const t=(await s.storage.local.get(l))[l];return t?{...c,...t}:c}catch(e){return console.error("[LexiLens] Failed to load settings:",e),c}}async function b(e){try{await s.storage.local.set({[l]:e})}catch(t){throw console.error("[LexiLens] Failed to save settings:",t),t}}async function m(e){const r={...await u(),...e};return await b(r),r}const h=new Map([["frend","friend"],["freind","friend"],["wich","which"],["thier","their"],["teh","the"],["taht","that"],["adn","and"],["becuase","because"],["beacuse","because"],["becasue","because"],["wierd","weird"],["recieve","receive"],["beleive","believe"],["belive","believe"],["definately","definitely"],["definatly","definitely"],["seperate","separate"],["occured","occurred"],["untill","until"],["tommorrow","tomorrow"],["tommorow","tomorrow"],["accomodate","accommodate"],["recomend","recommend"],["neccessary","necessary"],["necesary","necessary"],["goverment","government"],["enviroment","environment"],["occurence","occurrence"],["refered","referred"],["begining","beginning"],["arguement","argument"],["independant","independent"],["calender","calendar"],["existance","existence"],["experiance","experience"],["noticable","noticeable"],["publically","publicly"],["posession","possession"],["persistant","persistent"],["priviledge","privilege"],["pronounciation","pronunciation"],["questionaire","questionnaire"],["rythm","rhythm"],["sieze","seize"],["suprise","surprise"],["temperture","temperature"],["vaccuum","vacuum"],["doy","boy"],["dag","bag"],["dack","back"],["durger","burger"],["boor","door"],["bate","date"],["binner","dinner"],["qark","park"],["qen","pen"],["hte","the"],["thnk","think"],["dont","don't"],["didnt","didn't"],["cant","can't"],["wont","won't"],["wouldnt","wouldn't"],["couldnt","couldn't"],["shouldnt","shouldn't"],["youre","you're"],["theyre","they're"],["weve","we've"],["ive","I've"],["im","I'm"],["its","it's"],["nife","knife"],["nock","knock"],["nowledge","knowledge"],["rong","wrong"],["rite","write"],["riting","writing"],["anser","answer"],["lissen","listen"],["offen","often"],["wether","whether"],["wheather","weather"],["alot","a lot"],["alright","all right"],["everytime","every time"],["eachother","each other"],["incase","in case"]]),L=new Map([["their",["there","they're"]],["there",["their","they're"]],["they're",["their","there"]],["your",["you're"]],["you're",["your"]],["its",["it's"]],["it's",["its"]],["to",["too","two"]],["too",["to","two"]],["two",["to","too"]],["weather",["whether"]],["whether",["weather"]],["right",["write","rite"]],["write",["right","rite"]],["know",["no"]],["no",["know"]],["new",["knew"]],["knew",["new"]],["hear",["here"]],["here",["hear"]],["bye",["by","buy"]],["by",["bye","buy"]],["buy",["bye","by"]],["piece",["peace"]],["peace",["piece"]],["principal",["principle"]],["principle",["principal"]],["affect",["effect"]],["effect",["affect"]],["accept",["except"]],["except",["accept"]],["lose",["loose"]],["loose",["lose"]],["then",["than"]],["than",["then"]]]);function v(e){const t=[],r=T(e);for(const{word:n,start:o,end:i}of r){const w=n.toLowerCase(),p=h.get(w);if(p){t.push({original:n,suggestions:[g(n,p)],confidence:.95,source:"local",position:{start:o,end:i}});continue}const f=L.get(w);f&&t.push({original:n,suggestions:f.map(C=>g(n,C)),confidence:.5,source:"local",position:{start:o,end:i}})}return t}function T(e){const t=[],r=/[a-zA-Z]+(?:'[a-zA-Z]+)?/g;let n;for(;(n=r.exec(e))!==null;){const o=n[0];o.length<3&&!h.has(o.toLowerCase())||t.push({word:o,start:n.index,end:n.index+o.length})}return t}function g(e,t){return e===e.toUpperCase()?t.toUpperCase():e[0]===e[0].toUpperCase()?t.charAt(0).toUpperCase()+t.slice(1):t.toLowerCase()}async function x(e){const t=await s.tabs.query({}),r={type:"SETTINGS_UPDATED",payload:e};for(const n of t)if(n.id)try{await s.tabs.sendMessage(n.id,r)}catch{}}function k(e){s.runtime.onMessage.addListener((t,r,n)=>{const o=e(t,r);return o&&typeof o=="object"&&"then"in o?(o.then(n).catch(i=>{console.error("[LexiLens] Message handler error:",i),n({error:i.message})}),!0):!1})}const E=y(()=>{console.log("[LexiLens] Background service worker started"),S(),s.runtime.onInstalled.addListener(async e=>{e.reason==="install"&&(console.log("[LexiLens] Extension installed, initializing settings"),await u())})});function S(){k(async(e,t)=>{switch(console.log("[LexiLens] Received message:",e.type),e.type){case"ANALYZE_TEXT":return A(e.payload.text);case"GET_SETTINGS":return u();case"SETTINGS_UPDATED":return I(e.payload);default:return console.warn("[LexiLens] Unknown message type:",e.type),null}})}async function A(e){const t=Date.now(),r=v(e);return console.log("[LexiLens] Local suggestions:",r.length),{text:e,suggestions:r,timestamp:t}}async function I(e){const t=await m(e);return await x(e),t}function F(){}function a(e,...t){}const _={debug:(...e)=>a(console.debug,...e),log:(...e)=>a(console.log,...e),warn:(...e)=>a(console.warn,...e),error:(...e)=>a(console.error,...e)};let d;try{d=E.main(),d instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw _.error("The background crashed on startup!"),e}return d})();
